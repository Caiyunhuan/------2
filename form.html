<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>专家数据填写 - 风貌研判</title>
    <link rel="stylesheet" href="form.css">
</head>
<body>
    <div class="form-container">
        <header class="form-header">
            <button class="back-btn" onclick="window.location.href='index.html'">← 返回案例列表</button>
            <h1>专家数据填写</h1>
            <div class="case-info-header">
                <span id="caseIdDisplay">案例ID: -</span>
            </div>
        </header>

        <div class="form-layout">
            <aside class="reference-panel">
                <h2>参考信息</h2>
                
                <div class="info-section">
                    <h3>案例图片</h3>
                    
                    <h4 class="img-category-title">1. 建筑渲染图</h4>
                    <div id="img_render" class="images-container">
                        <div class="placeholder-text">（等待 render 图片...）</div>
                    </div>

                    <h4 class="img-category-title">2. 沿街主立面拼贴图</h4>
                    <div id="img_collage" class="images-container">
                        <div class="placeholder-text">（等待 collage 图片...）</div>
                    </div>

                    <h4 class="img-category-title">3. 建筑体量图</h4>
                    <div id="img_volume" class="images-container">
                        <div class="placeholder-text">（等待 Volume 图片...）</div>
                    </div>
                </div>
                
                <div class="info-section">
                    <h3>建筑ID</h3>
                    <div class="info-content" id="docID"><p>...</p></div>
                </div>

                <div class="info-section">
                    <h3>建筑类型</h3>
                    <div class="info-content" id="docType"><p>...</p></div>
                </div>

                <div class="info-section">
                    <h3>所属风貌区</h3>
                    <div class="info-content" id="docArea"><p>...</p></div>
                </div>

                <div class="info-section">
                    <h3>风貌管控规定</h3>
                    <div class="info-content" id="docRegulations"><p>...</p></div>
                </div>

                <div class="info-section">
                    <h3>方案风貌特征</h3>
                    <div class="info-content" id="docFeatures"><p>...</p></div>
                </div>

                <div class="info-section ai-section">
                    <h3>大模型生成内容-风貌特征描述</h3>
                    <p id="aiFeatureText" class="ai-text-display">（等待数据注入...）</p>
                </div>

                <div class="info-section ai-section">
                    <h3>大模型生成内容-风貌合规研判</h3>
                    <div id="aiComplianceText" class="ai-text-display">（等待数据注入...）</div>
                </div>
            </aside>

            <main class="expert-form-panel">
                <form id="expertForm" class="expert-form">
                    <section class="form-section">
                        <h2>1. 风貌特征描述确认</h2>
                        <div class="toggle-group">
                            <label class="toggle-label">
                                <input type="radio" name="featureAgree" value="yes" checked>
                                <span>同意大模型生成的内容</span>
                            </label>
                            <label class="toggle-label">
                                <input type="radio" name="featureAgree" value="no">
                                <span>否（需修改）</span>
                            </label>
                        </div>
                        <div id="featureInputArea" class="expert-input-group" style="display: none;">
                            <label>请修改风貌特征描述：</label>
                            <textarea id="featureEditable" name="featureEditable" rows="6"></textarea>
                        </div>
                    </section>

                    <section class="form-section">
                        <h2>2. 合规性综合判断</h2>
                        <div class="toggle-group">
                            <label class="toggle-label">
                                <input type="radio" name="complianceAgree" value="yes" checked>
                                <span>同意（全部合规）</span>
                            </label>
                            <label class="toggle-label">
                                <input type="radio" name="complianceAgree" value="no">
                                <span>否（需逐项修改）</span>
                            </label>
                        </div>

                        <div id="complianceInputArea" style="display: none;">
                            <p class="section-hint">请对以下五个方面进行逐项确认：</p>
                            
                            <div class="compliance-sub-item">
                                <div class="sub-item-header">
                                    <span class="sub-title">1. 色彩合规性</span>
                                    <div class="sub-toggle">
                                        <label><input type="radio" name="comp_color_agree" value="yes" checked onchange="toggleSubItem('color')"> 同意</label>
                                        <label><input type="radio" name="comp_color_agree" value="no" onchange="toggleSubItem('color')"> 修改</label>
                                    </div>
                                </div>
                                <div id="view_color" class="ai-text-readonly"></div>
                                <textarea id="edit_color" name="compliance_color" class="ai-text-editable" style="display:none"></textarea>
                            </div>

                            <div class="compliance-sub-item">
                                <div class="sub-item-header">
                                    <span class="sub-title">2. 材质合规性</span>
                                    <div class="sub-toggle">
                                        <label><input type="radio" name="comp_material_agree" value="yes" checked onchange="toggleSubItem('material')"> 同意</label>
                                        <label><input type="radio" name="comp_material_agree" value="no" onchange="toggleSubItem('material')"> 修改</label>
                                    </div>
                                </div>
                                <div id="view_material" class="ai-text-readonly"></div>
                                <textarea id="edit_material" name="compliance_material" class="ai-text-editable" style="display:none"></textarea>
                            </div>

                            <div class="compliance-sub-item">
                                <div class="sub-item-header">
                                    <span class="sub-title">3. 风格合规性</span>
                                    <div class="sub-toggle">
                                        <label><input type="radio" name="comp_style_agree" value="yes" checked onchange="toggleSubItem('style')"> 同意</label>
                                        <label><input type="radio" name="comp_style_agree" value="no" onchange="toggleSubItem('style')"> 修改</label>
                                    </div>
                                </div>
                                <div id="view_style" class="ai-text-readonly"></div>
                                <textarea id="edit_style" name="compliance_style" class="ai-text-editable" style="display:none"></textarea>
                            </div>

                            <div class="compliance-sub-item">
                                <div class="sub-item-header">
                                    <span class="sub-title">4. 立面合规性</span>
                                    <div class="sub-toggle">
                                        <label><input type="radio" name="comp_facade_agree" value="yes" checked onchange="toggleSubItem('facade')"> 同意</label>
                                        <label><input type="radio" name="comp_facade_agree" value="no" onchange="toggleSubItem('facade')"> 修改</label>
                                    </div>
                                </div>
                                <div id="view_facade" class="ai-text-readonly"></div>
                                <textarea id="edit_facade" name="compliance_facade" class="ai-text-editable" style="display:none"></textarea>
                            </div>

                            <div class="compliance-sub-item">
                                <div class="sub-item-header">
                                    <span class="sub-title">5. 体量合规性</span>
                                    <div class="sub-toggle">
                                        <label><input type="radio" name="comp_volume_agree" value="yes" checked onchange="toggleSubItem('volume')"> 同意</label>
                                        <label><input type="radio" name="comp_volume_agree" value="no" onchange="toggleSubItem('volume')"> 修改</label>
                                    </div>
                                </div>
                                <div id="view_volume" class="ai-text-readonly"></div>
                                <textarea id="edit_volume" name="compliance_volume" class="ai-text-editable" style="display:none"></textarea>
                            </div>
                        </div>
                    </section>

                    <section class="form-section">
                        <h2>3. 风貌品质研判</h2>
                        <p style="color: #666; font-size: 14px; margin-bottom: 20px;">请在 0.0 - 1.0 之间评分，步长 0.1。</p>
                        <div class="quality-category">
                            <h3>（一）风貌协调度评分<span style="font-size: 14px; font-weight: normal; color: #666;">（风貌协调度请根据左侧“沿街主立面拼贴图”来判断）</span></h3>
                            <div class="category-total">
                                <span>均值：</span>
                                <span class="score-display-large" id="score_coordination_total">0.0</span>
                            </div>
                            <div class="sub-indicators" id="group_coordination">
                                <div class="sub-item">
                                    <div class="sub-header"><label>1. 色彩协调度</label><span class="val-display" id="val_coordination_color">0.0</span></div>
                                    <input type="range" class="score-slider" name="coordination_color" min="0" max="1" step="0.1" value="0" oninput="updateScore('coordination')">
                                    <textarea placeholder="原因（选填）..." rows="1"></textarea>
                                </div>
                                <div class="sub-item">
                                    <div class="sub-header"><label>2. 材质协调度</label><span class="val-display" id="val_coordination_material">0.0</span></div>
                                    <input type="range" class="score-slider" name="coordination_material" min="0" max="1" step="0.1" value="0" oninput="updateScore('coordination')">
                                    <textarea placeholder="原因（选填）..." rows="1"></textarea>
                                </div>
                                <div class="sub-item">
                                    <div class="sub-header"><label>3. 风格协调度</label><span class="val-display" id="val_coordination_style">0.0</span></div>
                                    <input type="range" class="score-slider" name="coordination_style" min="0" max="1" step="0.1" value="0" oninput="updateScore('coordination')">
                                    <textarea placeholder="原因（选填）..." rows="1"></textarea>
                                </div>
                                <div class="sub-item">
                                    <div class="sub-header"><label>4. 立面协调度</label><span class="val-display" id="val_coordination_facade">0.0</span></div>
                                    <input type="range" class="score-slider" name="coordination_facade" min="0" max="1" step="0.1" value="0" oninput="updateScore('coordination')">
                                    <textarea placeholder="原因（选填）..." rows="1"></textarea>
                                </div>
                                <div class="sub-item">
                                    <div class="sub-header"><label>5. 体量协调度</label><span class="val-display" id="val_coordination_volume">0.0</span></div>
                                    <input type="range" class="score-slider" name="coordination_volume" min="0" max="1" step="0.1" value="0" oninput="updateScore('coordination')">
                                    <textarea placeholder="原因（选填）..." rows="1"></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="quality-category">
                            <h3>（二）风貌延续度评分</h3>
                            <div class="category-total">
                                <span>均值：</span>
                                <span class="score-display-large" id="score_continuity_total">0.0</span>
                            </div>
                            <div class="sub-indicators" id="group_continuity">
                                <div class="sub-item">
                                    <div class="sub-header"><label>1. 色彩延续度</label><span class="val-display" id="val_continuity_color">0.0</span></div>
                                    <input type="range" class="score-slider" name="continuity_color" min="0" max="1" step="0.1" value="0" oninput="updateScore('continuity')">
                                    <textarea placeholder="原因..." rows="1"></textarea>
                                </div>
                                <div class="sub-item">
                                    <div class="sub-header"><label>2. 材质延续度</label><span class="val-display" id="val_continuity_material">0.0</span></div>
                                    <input type="range" class="score-slider" name="continuity_material" min="0" max="1" step="0.1" value="0" oninput="updateScore('continuity')">
                                    <textarea placeholder="原因..." rows="1"></textarea>
                                </div>
                                <div class="sub-item">
                                    <div class="sub-header"><label>3. 风格延续度</label><span class="val-display" id="val_continuity_style">0.0</span></div>
                                    <input type="range" class="score-slider" name="continuity_style" min="0" max="1" step="0.1" value="0" oninput="updateScore('continuity')">
                                    <textarea placeholder="原因..." rows="1"></textarea>
                                </div>
                                <div class="sub-item">
                                    <div class="sub-header"><label>4. 立面延续度</label><span class="val-display" id="val_continuity_facade">0.0</span></div>
                                    <input type="range" class="score-slider" name="continuity_facade" min="0" max="1" step="0.1" value="0" oninput="updateScore('continuity')">
                                    <textarea placeholder="原因..." rows="1"></textarea>
                                </div>
                                <div class="sub-item">
                                    <div class="sub-header"><label>5. 体量延续度</label><span class="val-display" id="val_continuity_volume">0.0</span></div>
                                    <input type="range" class="score-slider" name="continuity_volume" min="0" max="1" step="0.1" value="0" oninput="updateScore('continuity')">
                                    <textarea placeholder="原因..." rows="1"></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="quality-category">
                            <h3>（三）风貌创新度评分</h3>
                            <div class="category-total">
                                <span>均值：</span>
                                <span class="score-display-large" id="score_innovation_total">0.0</span>
                            </div>
                            <div class="sub-indicators" id="group_innovation">
                                <div class="sub-item">
                                    <div class="sub-header"><label>1. 色彩创新度</label><span class="val-display" id="val_innovation_color">0.0</span></div>
                                    <input type="range" class="score-slider" name="innovation_color" min="0" max="1" step="0.1" value="0" oninput="updateScore('innovation')">
                                    <textarea placeholder="原因..." rows="1"></textarea>
                                </div>
                                <div class="sub-item">
                                    <div class="sub-header"><label>2. 材质创新度</label><span class="val-display" id="val_innovation_material">0.0</span></div>
                                    <input type="range" class="score-slider" name="innovation_material" min="0" max="1" step="0.1" value="0" oninput="updateScore('innovation')">
                                    <textarea placeholder="原因..." rows="1"></textarea>
                                </div>
                                <div class="sub-item">
                                    <div class="sub-header"><label>3. 风格创新度</label><span class="val-display" id="val_innovation_style">0.0</span></div>
                                    <input type="range" class="score-slider" name="innovation_style" min="0" max="1" step="0.1" value="0" oninput="updateScore('innovation')">
                                    <textarea placeholder="原因..." rows="1"></textarea>
                                </div>
                                <div class="sub-item">
                                    <div class="sub-header"><label>4. 立面创新度</label><span class="val-display" id="val_innovation_facade">0.0</span></div>
                                    <input type="range" class="score-slider" name="innovation_facade" min="0" max="1" step="0.1" value="0" oninput="updateScore('innovation')">
                                    <textarea placeholder="原因..." rows="1"></textarea>
                                </div>
                                <div class="sub-item">
                                    <div class="sub-header"><label>5. 体量创新度</label><span class="val-display" id="val_innovation_volume">0.0</span></div>
                                    <input type="range" class="score-slider" name="innovation_volume" min="0" max="1" step="0.1" value="0" oninput="updateScore('innovation')">
                                    <textarea placeholder="原因..." rows="1"></textarea>
                                </div>
                            </div>
                        </div>

                        <section class="form-section">
                            <h2>4. 优化建议</h2>
                            <textarea name="optimizationSuggestion" rows="5" placeholder="请输入优化建议..."></textarea>
                        </section>
    
                        <section class="form-section">
                            <h2>5. 最终结论</h2>
                            <div class="toggle-group">
                                <label class="toggle-label">
                                    <input type="radio" name="finalConclusion" value="pass" required>
                                    <span>建议通过</span>
                                </label>
                                <label class="toggle-label">
                                    <input type="radio" name="finalConclusion" value="reject" required>
                                    <span>不通过</span>
                                </label>
                            </div>
                        </section>
    
                        <div class="form-actions">
                            <button type="submit" class="submit-btn">提交完成</button>
                        </div>
                </form>
            </main>
        </div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="data.js"></script>
    
    <script src="form.js"></script>
</body>
</html>